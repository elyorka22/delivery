# Как добавить переменные окружения в Railway

## Пошаговая инструкция

### Шаг 1: Открыть настройки сервиса

1. Зайдите на https://railway.app
2. Войдите в свой аккаунт
3. Откройте ваш проект (project)
4. Кликните на сервис (service) - тот, который вы задеплоили
5. Перейдите в **Settings** (вкладка слева в меню)

### Шаг 2: Найти секцию Variables

1. В настройках прокрутите вниз
2. Найдите секцию **"Variables"** или **"Environment Variables"**
3. Вы увидите список переменных (если они уже есть) или пустое поле

### Шаг 3: Добавить переменные

Для каждой переменной:

1. Нажмите кнопку **"New Variable"** или **"+ New"**
2. В поле **"Name"** введите имя переменной
3. В поле **"Value"** введите значение
4. Нажмите **"Add"** или **"Save"**

Повторите для каждой переменной.

---

## Переменные для добавления

### 1. DATABASE_URL

**Имя:** `DATABASE_URL`

**Значение:** Connection String из Supabase

#### Как получить DATABASE_URL из Supabase:

1. Зайдите на https://supabase.com
2. Войдите в свой аккаунт
3. Откройте ваш проект
4. Перейдите в **Settings** → **Database**
5. Найдите секцию **"Connection string"**
6. Выберите вкладку **"URI"**
7. Скопируйте строку подключения

**Формат будет:**
```
postgresql://postgres:[YOUR-PASSWORD]@db.[PROJECT-REF].supabase.co:5432/postgres
```

**Важно:**
- Замените `[YOUR-PASSWORD]` на ваш реальный пароль от Supabase
- Если пароль содержит специальные символы (`#`, `+`, `$`, `_`, `@` и т.д.), их нужно **URL-encode**:
  - `#` → `%23`
  - `+` → `%2B`
  - `$` → `%24`
  - `@` → `%40`
  - `&` → `%26`
  - `=` → `%3D`
  - `?` → `%3F`
  - `/` → `%2F`
  - ` ` (пробел) → `%20`

**Пример:**
Если пароль: `My#Pass+123`
То в URL должно быть: `My%23Pass%2B123`

**Полный пример DATABASE_URL:**
```
postgresql://postgres:My%23Pass%2B123@db.abcdefgh.supabase.co:5432/postgres
```

---

### 2. JWT_SECRET

**Имя:** `JWT_SECRET`

**Значение:** Сгенерированный безопасный ключ

#### Как сгенерировать JWT_SECRET:

**Вариант 1: Через терминал (Mac/Linux)**

```bash
openssl rand -base64 32
```

Скопируйте результат и используйте как значение.

**Вариант 2: Через онлайн генератор**

1. Зайдите на https://www.random.org/strings/
2. Настройте:
   - Length: 32
   - Characters: Letters and Numbers
3. Сгенерируйте строку

**Вариант 3: Через Node.js**

```bash
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
```

**Пример сгенерированного JWT_SECRET:**
```
aB3dE5fG7hI9jK1lM3nO5pQ7rS9tU1vW3xY5zA7bC9dE1fG3hI5jK7lM9nO1p
```

**Важно:** 
- Используйте длинный случайный ключ (минимум 32 символа)
- НЕ используйте простые слова или даты
- Храните ключ в безопасности

---

### 3. FRONTEND_URL

**Имя:** `FRONTEND_URL`

**Значение:** URL вашего Vercel проекта

#### Как получить FRONTEND_URL:

**Если frontend еще не задеплоен:**

Временно используйте placeholder:
```
https://yourproject.vercel.app
```

**После деплоя frontend на Vercel:**

1. Зайдите на https://vercel.com
2. Откройте ваш проект
3. Скопируйте URL (например: `https://delivery-app.vercel.app`)
4. Обновите переменную `FRONTEND_URL` в Railway на этот URL

**Важно:** 
- Используйте полный URL с `https://`
- Без слеша в конце

**Пример:**
```
https://delivery-app.vercel.app
```

---

### 4. NODE_ENV

**Имя:** `NODE_ENV`

**Значение:** `production`

Это указывает, что приложение работает в продакшене.

---

## Полный пример переменных

После добавления всех переменных в Railway вы должны увидеть:

```
DATABASE_URL = postgresql://postgres:My%23Pass%2B123@db.abcdefgh.supabase.co:5432/postgres
JWT_SECRET = aB3dE5fG7hI9jK1lM3nO5pQ7rS9tU1vW3xY5zA7bC9dE1fG3hI5jK7lM9nO1p
FRONTEND_URL = https://delivery-app.vercel.app
NODE_ENV = production
```

---

## После добавления переменных

1. **Railway автоматически перезапустит сервер** после добавления переменных
2. Проверьте логи:
   - Откройте **Deployments** → последний деплой
   - Откройте **Logs**
   - Должны увидеть: `Server is running on port 8080`
3. Проверьте подключение к базе данных:
   - Если есть ошибки подключения, проверьте `DATABASE_URL`
   - Убедитесь, что пароль правильно URL-encoded

---

## Проверка работы

### 1. Проверить Health endpoint

Откройте в браузере:
```
https://yourproject.up.railway.app/api/health
```

Должен вернуться:
```json
{
  "status": "ok",
  "message": "Server is running"
}
```

### 2. Проверить подключение к базе данных

Если сервер запустился без ошибок, значит подключение к базе данных работает.

Если есть ошибки в логах про базу данных:
- Проверьте `DATABASE_URL`
- Убедитесь, что Supabase проект активен
- Проверьте пароль (может быть неправильно URL-encoded)

---

## Troubleshooting

### Проблема: Не могу найти секцию Variables

**Решение:**
1. Убедитесь, что вы в правильном сервисе (service)
2. Перейдите в **Settings** (не Deployments или Logs)
3. Прокрутите вниз - Variables обычно внизу страницы

### Проблема: DATABASE_URL не работает

**Решение:**
1. Проверьте, что пароль правильно URL-encoded
2. Убедитесь, что используете правильный Connection String из Supabase
3. Проверьте, что Supabase проект активен
4. Попробуйте использовать Connection String без `?pgbouncer=true` (если есть)

### Проблема: Сервер не перезапускается после добавления переменных

**Решение:**
1. Вручную перезапустите: **Deployments** → **Redeploy**
2. Или подождите несколько минут - Railway может перезапустить автоматически

### Проблема: Ошибка "Invalid JWT_SECRET"

**Решение:**
1. Убедитесь, что JWT_SECRET достаточно длинный (минимум 32 символа)
2. Проверьте, что нет лишних пробелов в начале или конце значения

---

## Важные моменты

1. **Безопасность:**
   - НЕ коммитьте переменные окружения в Git
   - НЕ делитесь JWT_SECRET публично
   - Используйте разные JWT_SECRET для разных окружений

2. **Обновление переменных:**
   - После изменения переменных Railway перезапустит сервер
   - Изменения вступят в силу сразу

3. **Порядок добавления:**
   - Можно добавлять переменные в любом порядке
   - Но лучше начать с `DATABASE_URL` и `JWT_SECRET`
   - `FRONTEND_URL` можно добавить после деплоя frontend

---

## Готово! ✅

После добавления всех переменных ваш backend будет полностью настроен и готов к работе!



